<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NEXUS - KESÄ°N Ã‡Ã–ZÃœM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        body { background-color: #111; color: white; font-family: sans-serif; padding: 20px; text-align: center; }
        .box { border: 2px solid #333; padding: 20px; margin: 20px auto; max-width: 400px; border-radius: 10px; background: #222; }
        .btn { background: #00f2ff; color: black; font-weight: bold; padding: 15px; width: 100%; border: none; cursor: pointer; border-radius: 5px; margin-top: 10px; }
        .btn:hover { background: #00c8ff; }
        #status { font-weight: bold; margin-bottom: 10px; }
        .success { color: #0f0; }
        .error { color: #f00; }
    </style>
</head>
<body>

    <h1>ğŸ”¥ FÄ°NAL VERSÄ°YON ğŸ”¥</h1>
    <p>ModÃ¼l sistemi iptal edildi. Klasik sistem devrede.</p>

    <div class="box">
        <div id="status">VeritabanÄ±na BaÄŸlanÄ±yor...</div>
        <hr style="border-color: #444; margin: 15px 0;">
        
        <div style="font-size: 12px; color: #888;">SUNUCUDAKÄ° BAKÄ°YE:</div>
        <div id="balance" style="font-size: 40px; font-weight: bold;">---</div>
        
        <button onclick="addMoney()" class="btn">ğŸ’° 50 TON EKLE VE KAYDET</button>
        <button onclick="location.reload()" class="btn" style="background: #444; color: white;">ğŸ”„ SAYFAYI YENÄ°LE (TEST)</button>
    </div>

    <script>
        // 1. AYARLAR (Senin Bilgilerin)
        const firebaseConfig = {
            apiKey: "AIzaSyDXwByb4qNJeH5F9pYA8ry-zYcBhdzKsOo",
            authDomain: "tonm-77373.firebaseapp.com",
            projectId: "tonm-77373",
            storageBucket: "tonm-77373.firebasestorage.app",
            messagingSenderId: "507031118335",
            appId: "1:507031118335:web:1d209e303dca154ec487ca",
            measurementId: "G-5EV1T50VK8"
        };

        // 2. BAÅLATMA (Eski UsÃ¼l - Hata vermez)
        try {
            firebase.initializeApp(firebaseConfig);
            const db = firebase.firestore();
            console.log("Firebase BaÅŸladÄ±.");

            // SABÄ°T KÄ°MLÄ°K (Asla deÄŸiÅŸmez)
            const USER_ID = "PATRON_FINAL_FIX";
            let currentBalance = 0;

            const statusEl = document.getElementById('status');
            const balanceEl = document.getElementById('balance');

            // --- VERÄ° OKUMA ---
            function loadData() {
                statusEl.innerText = "â³ Veri Ã‡ekiliyor...";
                
                db.collection("users").doc(USER_ID).get()
                .then((doc) => {
                    if (doc.exists) {
                        currentBalance = doc.data().balance;
                        balanceEl.innerText = currentBalance + " TON";
                        statusEl.innerHTML = "<span class='success'>âœ… BAÅARILI: Veri Geldi!</span>";
                    } else {
                        statusEl.innerText = "ğŸ†• KayÄ±t Yok. Yeni oluÅŸturuluyor...";
                        saveData(10); // Ä°lk aÃ§Ä±lÄ±ÅŸta 10 ver
                    }
                })
                .catch((error) => {
                    console.error("Okuma HatasÄ±:", error);
                    statusEl.innerHTML = "<span class='error'>âŒ OKUMA HATASI: " + error.message + "</span>";
                });
            }

            // --- VERÄ° YAZMA ---
            function saveData(newBal) {
                statusEl.innerText = "ğŸ’¾ Kaydediliyor...";
                
                if(newBal !== undefined) currentBalance = newBal;

                db.collection("users").doc(USER_ID).set({
                    balance: currentBalance,
                    lastUpdate: new Date().toISOString()
                }, { merge: true })
                .then(() => {
                    balanceEl.innerText = currentBalance + " TON";
                    statusEl.innerHTML = "<span class='success'>âœ… KAYDEDÄ°LDÄ°! (Åimdi yenile)</span>";
                })
                .catch((error) => {
                    console.error("Yazma HatasÄ±:", error);
                    statusEl.innerHTML = "<span class='error'>âŒ YAZMA HATASI: " + error.message + "</span>";
                    
                    if(error.message.includes("permission-denied")) {
                        alert("HATA: Firebase 'Kurallar' (Rules) kÄ±smÄ± hala kilitli! LÃ¼tfen 'Publish' butonuna bastÄ±ÄŸÄ±ndan emin ol.");
                    }
                });
            }

            // Buton Fonksiyonu
            window.addMoney = function() {
                currentBalance += 50;
                saveData();
            }

            // Oyunu BaÅŸlat
            loadData();

        } catch (e) {
            alert("KRÄ°TÄ°K HATA: " + e.message);
        }
    </script>
</body>
</html>
