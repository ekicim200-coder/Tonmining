<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase BaÄŸlantÄ± Testi</title>
    <style>
        body { background-color: #111; color: white; font-family: monospace; padding: 20px; }
        #log-box { 
            background: #000; border: 1px solid #333; padding: 15px; 
            height: 400px; overflow-y: auto; white-space: pre-wrap; font-size: 14px;
        }
        .success { color: #0f0; }
        .error { color: #f00; font-weight: bold; }
        .info { color: #0ff; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; margin-bottom: 20px; font-size: 16px;}
    </style>

    <script src="https://www.gstatic.com/firebasejs/9.1.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.1/firebase-auth-compat.js"></script>
</head>
<body>

    <h1>ğŸ”¥ Firebase BaÄŸlantÄ± Testi</h1>
    <p>AÅŸaÄŸÄ±daki butona bas ve Ã§Ä±kan yazÄ±larÄ± oku (veya ekran gÃ¶rÃ¼ntÃ¼sÃ¼ at).</p>
    <button onclick="runTest()">TESTÄ° BAÅLAT</button>
    
    <div id="log-box">Loglar bekleniyor...</div>

    <script>
        // --- 1. AYARLAR ---
        const firebaseConfig = {
            apiKey: "AIzaSyDXwByb4qNJeH5F9pYA8ry-zYcBhdzKsOo",
            authDomain: "tonm-77373.firebaseapp.com",
            projectId: "tonm-77373",
            storageBucket: "tonm-77373.firebasestorage.app",
            messagingSenderId: "507031118335",
            appId: "1:507031118335:web:1d209e303dca154ec487ca",
            measurementId: "G-5EV1T50VK8"
        };

        // --- 2. LOG FONKSÄ°YONU ---
        function log(msg, type = 'info') {
            const box = document.getElementById('log-box');
            const color = type === 'error' ? 'red' : (type === 'success' ? '#0f0' : '#0ff');
            const icon = type === 'error' ? 'âŒ' : (type === 'success' ? 'âœ…' : 'â„¹ï¸');
            box.innerHTML += `<div style="color:${color}">${icon} ${msg}</div>`;
            console.log(msg);
        }

        // --- 3. TEST FONKSÄ°YONU ---
        async function runTest() {
            document.getElementById('log-box').innerHTML = ''; // Temizle
            log("Test BaÅŸlatÄ±lÄ±yor...", 'info');

            // ADIM 1: BaÅŸlatma
            try {
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                    log("Firebase BaÅŸlatÄ±ldÄ± (InitializeApp)", 'success');
                } else {
                    log("Firebase zaten aÃ§Ä±k.", 'info');
                }
            } catch (e) {
                log("ADIM 1 HATA: Firebase BaÅŸlatÄ±lamadÄ±! Kodda hata var.\n" + e.message, 'error');
                return;
            }

            const db = firebase.firestore();
            const auth = firebase.auth();

            // ADIM 2: Auth (GiriÅŸ)
            log("Anonim GiriÅŸ deneniyor...", 'info');
            try {
                await auth.signInAnonymously();
                const user = auth.currentUser;
                if(user) {
                    log(`GiriÅŸ BaÅŸarÄ±lÄ±! User ID: ${user.uid}`, 'success');
                } else {
                    throw new Error("KullanÄ±cÄ± objesi boÅŸ geldi.");
                }
            } catch (e) {
                log("ADIM 2 HATA: GiriÅŸ YapÄ±lamadÄ±!", 'error');
                log("SEBEP: " + e.code + " - " + e.message, 'error');
                log("Ã‡Ã–ZÃœM: Firebase Panel > Authentication > Sign-in Method > Anonymous 'Enable' yapÄ±lmamÄ±ÅŸ!", 'info');
                return;
            }

            // ADIM 3: Veri Yazma
            log("VeritabanÄ±na yazma deneniyor...", 'info');
            try {
                await db.collection("test_logs").doc("test_doc").set({
                    mesaj: "Bu bir test verisidir",
                    zaman: new Date().toISOString()
                });
                log("VERÄ° YAZMA BAÅARILI! VeritabanÄ± Ã§alÄ±ÅŸÄ±yor.", 'success');
            } catch (e) {
                log("ADIM 3 HATA: Veri YazÄ±lamadÄ±!", 'error');
                log("HATA KODU: " + e.code, 'error');
                
                if(e.code === 'permission-denied') {
                    log("âš ï¸ SORUN BULUNDU: Ä°ZÄ°N HATASI (Permission Denied)", 'error');
                    log("Ã‡Ã–ZÃœM: Firebase Panel > Firestore Database > Rules kÄ±smÄ±na git ve ÅŸu kodu yapÄ±ÅŸtÄ±r:", 'info');
                    log(`allow read, write: if request.auth != null;`, 'info');
                } else {
                    log("Bilinmeyen bir hata: " + e.message, 'error');
                }
                return;
            }

            // ADIM 4: Veri Okuma
            log("YazÄ±lan veriyi okuma deneniyor...", 'info');
            try {
                const doc = await db.collection("test_logs").doc("test_doc").get();
                if(doc.exists) {
                    log("VERÄ° OKUMA BAÅARILI! Gelen Veri:", 'success');
                    log(JSON.stringify(doc.data()), 'info');
                    log("ğŸ‰ TEBRÄ°KLER! SÄ°STEM %100 Ã‡ALIÅIYOR.", 'success');
                } else {
                    log("Veri yazÄ±ldÄ± ama okunamadÄ± (Garip bir durum).", 'error');
                }
            } catch (e) {
                log("Okuma HatasÄ±: " + e.message, 'error');
            }
        }
    </script>
</body>
</html>
